@attribute [Route(PageUrl)]

@implements IDisposable

@using Autowatchers.BlazorWasm.Watchers
@using Autowatchers.BlazorWasm.Components

<PageTitle>Counter</PageTitle>

<h1>Counter</h1>

<p role="status">Current count of page: <span id="PageCurrentValue">@CountWatcher.CurrentValue</span></p>

@if (CountIsAtLimit)
{
    <p id="PageCountIsAtLimit">The count of page is 10</p>
}

@if (CountIsAboveLimit)
{
    <p id="PageCountIsAboveLimit">The count of page is above 10</p>
}

<button class="btn btn-primary" id="PageButton" @onclick="IncrementCount">Click me</button>

<hr />

<CounterComponent />

@code {
    public const string PageUrl = "/counter";

    bool CountIsAtLimit { get; set; }
    bool CountIsAboveLimit { get; set; }

    AutoGeneratedCountWatcher CountWatcher { get; set; } = default!;

    protected override void OnInitialized()
    {
        base.OnInitialized();

        CountWatcher = new AutoGeneratedCountWatcher(new CounterVm());

        CountWatcher.CurrentValueChanged += CountChanged;

    }

    private void CountChanged(int old, int _new)
    {
        CountIsAtLimit = _new == CounterVm.CounterLimit;
        CountIsAboveLimit = _new > CounterVm.CounterLimit;
    }

    public void IncrementCount()
    {
        CountWatcher.CurrentValue += 1;
    }

    public void Dispose()
    {
        CountWatcher.CurrentValueChanged -= CountChanged;

    }

}
